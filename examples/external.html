<html>
    <head>
        <style>
            body,
            html {
                margin: 0;
                background: black;
            }

            #viewport {
                width: 1280px;
                height: 720px;
            }
        </style>
    </head>

    <body>
        <div id="viewport"></div>

        <script src="../node_modules/three/build/three.min.js"></script>
        <script src="../dist/tetsuo.min.js"></script>

        <script>
            var sceneOne, sceneTwo, cameraOne, cameraTwo, box, ball, node;

            function createSceneOne() {
                sceneOne = new THREE.Scene();
                cameraOne = new THREE.PerspectiveCamera(
                    75,
                    1280 / 720,
                    0.1,
                    1000
                );
                cameraOne.position.z = 4;

                box = new THREE.Mesh(
                    new THREE.BoxGeometry(1, 1, 1),
                    new THREE.MeshNormalMaterial()
                );

                sceneOne.add(box);
            }

            function createSceneTwo() {
                sceneTwo = new THREE.Scene();
                cameraTwo = new THREE.PerspectiveCamera(
                    75,
                    1280 / 720,
                    0.1,
                    1000
                );
                cameraTwo.position.z = 4;

                ball = new THREE.Mesh(
                    new THREE.SphereGeometry(1, 20, 20),
                    new THREE.MeshNormalMaterial()
                );

                sceneTwo.add(ball);
            }

            function switchToSceneOne() {
                node.scene = sceneOne;
                node.camera = cameraOne;
            }

            function switchToSceneTwo() {
                node.scene = sceneTwo;
                node.camera = cameraTwo;
            }

            function updateSceneOne(time) {
                box.rotation.set(Math.sin(time), Math.cos(time), 0);
            }

            function updateSceneTwo(time) {
                cameraTwo.position.z = 4 + Math.sin(time);
                ball.position.set(Math.sin(time), Math.cos(time), 0);
            }

            TETSUO.Utils.ready(() => {
                let renderer = new TETSUO.NodeRenderer();

                createSceneOne();
                createSceneTwo();

                node = new TETSUO.THREENode("three", {
                    sceneOne,
                    cameraOne,
                });

                renderer.connectToScreen(node);

                let onSceneOne = true;
                setInterval(() => {
                    onSceneOne = !onSceneOne;
                    onSceneOne ? switchToSceneOne() : switchToSceneTwo();
                }, 2000);

                function tick() {
                    time = performance.now() / 1000;

                    onSceneOne ? updateSceneOne(time) : updateSceneTwo(time);

                    renderer.update(time);
                    renderer.render();

                    requestAnimationFrame(tick);
                }

                tick();
            });
        </script>
    </body>
</html>
